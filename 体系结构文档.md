
## 引言

### 编制目的

本报告详细完成对铁路购票系统的概要设计，达到指导详细设计和开发的目的，同时实现和测试人员及用户的沟通。

本报告面向开发人员、测试人员及最终用户而编写，是了解系统的导航

### 参考资料

(1) IEEE标准

(2)《软件工程与计算（卷二）软件开发的技术基础》

(3) 详细设计文档

## 产品概述

参考铁路购票系统用例文档和铁路购票系统软件需求规格说明中对产品的概括描述。


## 逻辑视图

- 处理静态设计模型
    
    酒店预定系统中，选择了分层体系结构风格，将系统分为4部分（view、controller、service、data）能够很好地示意整个高层抽象。view部分包含GUI页面的实现，controller部分负责接受前端发送的请求并分发给相应的service，service部分负责业务逻辑的实现，data部分负责数据的持久化和访问。分层体系结构的逻辑视角和逻辑设计方案如下图所示。

![[Pasted image 20230707235017.png]]


## 组合视图

### 开发包图

- 表示软件组件在开发时环境中的静态组织
    - 描述开发包以及相互间的依赖
    - 绘制开发包图
        - 开发包图类似上述示意图画法

|开发包|依赖的其他开发包|
|:-:|---|
|mainui|userui、manageui、vo、clientui|
|userui|ant-design-vue, vo, usercontroller|
|traincontroller|trainservice, po,|
|trainservice|trainmapper, po|
|trainmapper|Mybatis, po|
|stationui|ant-design-vue, vo, stationController|
|stationcontroller|stationservice. po, vo|
|stationservice|stationmapper, po, vo|
|stationmapper|Mybatis, po, vo|
|routeui|ant-design-vue, vo, routecontroller|
|routecontroller|routeservice, vo, util|
|routeservice|routemapper, trainservice, vo, po, util|
|routemapper|Mybatis, po|
|orderui|ordercontroller, vo|
|ordercontroller|orderservice, po, vo|
|orderservice|ordermapper, hotelservice, userservice, po, vo|
|ordermapper|Mybatis, po|
|userui|ant-design-vue, vo|
|usercontroller|userserivce, vo, po|
|userservice|usermapper, vo, po|
|usermapper|Mybatis, po|
|vo||
|po||
|util||
|ant-design-vue||
|Mybatis|JDBC|
|REST API||

### 运行时进程

- 表示软件在运行时进程间的交互，描述系统的动态结构
    
    - 绘制进程图
- 示意图：
- ![[Pasted image 20230707235422.png]]

## 架构设计

- 描述功能分解和如何在不同的层中安排软件模块
    - 描述架构中的对象，包含架构图
    - 描述组件接口信息，包括：语法、前置条件、后置条件
​
#### 模块职责

- 模块视图
![[Pasted image 20230707235518.png]]

各层职责

- 客户端各层的职责

|层|职责|
|:-:|:-:|
|启动模块|负责初始化网络通信，渲染浏览器界面|
|用户界面层|基于浏览器窗口的铁路购票系统客户端用户界面|
|业务逻辑层|对于用户界面的输入和选择进行响应并进行业务处理逻辑|
 |网络模块|和服务器端交互|

- 服务端各层的职责

|层|职责|
|:-:|:-:|
|Controller层|负责响应客户端发送的请求并且转发给Service层并且返回请求结果|
|Service层|负责和数据层交互，实现业务逻辑|
|data层|负责数据的持久化及数据访问接口|

- 层之间调用接口

|接口|服务调用方|服务提供方|
|:-:|:-:|:-:|
|UserService  <br>TrainService  <br>StationService  <br>RouteService  <br>OrderService|服务端Controller层|服务端Service层|
|UserMapper  <br>TrainMapper  <br>StationMapper  <br>RouteMapper  <br>OrderMapper|服务端Service层|服务端data层|
|UserController  <br>TrainController  <br>StationController  <br>RouteController  <br>OrderController|客户端展示层|服务端Controller层|



#### 用户界面层分解

##### 职责

- 接口规范
- 需要的服务接口

##### 用户界面层模块接口规范

#### 业务逻辑层分解
业务逻辑层包括多个针对界面的业务逻辑处理对象。例如UserService对象负责处理用户界面相关的业务逻辑；TrainService对象负责处理列车相关的业务逻辑；RouteService对象负责处理车次界面相关的业务逻辑；OrderService对象负责处理订单界面相关的业务逻辑；StationService对象负责处理车站相关的业务逻辑。

##### 业务逻辑层模块的逻辑

每个bl模块由Service接口与它的ServiceImpl实现组成

|模块|职责|
|---|---|
|userbl|负责实现用户界面所需要的服务|
|trainbl|负责实现列车界面所需要的服务|
|stationbl|负责实现车站界面所需要的服务|
|routebl|负责实现车次界面所需要的服务|
|orderbl|负责实现订单界面所需要的服务|

业务逻辑层模块的接口规范

userbl, trainbl, stationrbl, routebl，orderbl模块的接口规范分别如下

userbl模块的接口规范

|提供的服务（供接口）|语法|前置条件|后置条件|
|---|---|---|---|
|UserService.login|void login(String username, String password)|||
|UserService.register|void register(String username, String password, String name, String idn, String phone, String type);|||
|UserService.findByUserName|UserEntity findByUserName(String username)|||
|UserService.editInfo|void editInfo(String username, String name, String idn, String phone, String type)|||

|需要的服务（需接口）|服务|
|---|---|
|@Autowired UserMapper|得到User数据库接口的引用
|UserMapper.toUserVO|将实体转化成view object|

trainbl模块的接口规范：

|提供的服务（供接口）|语法|前置条件|后置条件|
|---|---|---|---|
|TrainService.getTrain|public TrainDetailVO getTrain(Long trainId);|||
|TrainService.listTrains|public List<> listTrains(Long startStationId, Long endStationId, String date)|||
|TrainService.listTrainsAdmin|public List<> listTrainsAdmin();|||
|TrainService.addTrain|public void addTrain(String name, Long routeId, TrainType type, String date, List<> arrivalTimes,  List<> departureTimes)|||
|TrainService.changeTrain|public void changeTrain(Long trainId, String name, Long routeId, TrainType type, String date, List<> arrivalTimes,  List<> departureTimes)|||
|TrainService.deleteTrain|public void deleteTrain(Long trainId)|||

|需要的服务（需接口）|服务|
|---|---|
|@Autowired TrainMapper|得到Train数据库接口的引用|
|TrainMapper.toTrainVO|将实体转化成view object|
|TrainMapper.toAdminTrainVO|将实体转化成view object|

stationbl模块的接口规范：

|提供的服务（供接口）|语法|前置条件|后置条件|
|---|---|---|---|
|StationService.getStation|public StationVO getStation(Long stationId)|||
|StationService.listStations|public List<> listStations()|||
|StationService.addStation|public void addStation(String name)|||
|StationService.editStation|public void editStation(Long stationId, String name)|||

|需要的服务（需接口）|服务|
|---|---|
|@Autowired StationMapper|得到Station数据库接口的引用|
|StationMapper.toStationVO|将实体转化成view object|

routebl模块的接口规范：

|提供的服务（供接口）|语法|前置条件|后置条件|
|---|---|---|---|
|RouteService.addRoute|void addRoute(String name, List<> stationIds)|||
|RouteService.listRoutes|List<> listRoutes()|||
|RouteService.getRoute|RouteVO getRoute(Long id)|||
|RouteService.editRoute|void editRoute(Long id, String name, List<> stationIds)|||

|需要的服务（需接口）|服务|
|---|---|
|@Autowired RouteMapper|得到Route数据库接口的引用|
|RouteMapper.toRouteVO|将实体转化成view object|

orderbl模块的接口规范：

|提供的服务（供接口）|语法|前置条件|后置条件|
|---|---|---|---|
|OrderService.createOrder|Long createOrder(String username, Long trainId, Long fromStationId, Long toStationId, String seatType, Long seatNumber)|||
|OrderService.listOrders|List<> listOrders(String username)|||
|OrderService.getOrder|OrderVO getOrder(Long id)|||
|OrderService.cancelOrder|void cancelOrder(Long id)|||
|OrderService.payOrder|void payOrder(Long id)|||

|需要的服务（需接口）|服务|
|---|---|
|@Autowired OrderMapper|得到Order数据库接口的引用|
|OrderMapper.toOrderVO|将实体转化成view object


#### 数据层分解

数据层主要给业务逻辑层提供数据访问服务，包括对于持久化数据的增删改查，持久化数据的保存方式是采用PostgreSQL数据库；

##### 数据层的职责

|模块|职责|
|---|---|
|UserMapper|基于PostgreSQL数据库的User表的接口，提供增删改查服务|
|TrainMapper|基于PostgreSQL数据库的Train表的接口，提供增删改查服务|
|StationMapper|基于PostgreSQL数据库的Station表的接口，提供增删改查服务|
|RouteMapper|基于PostgreSQL数据库的Route表的接口，提供增删改查服务|
|OrderMapper|基于PostgreSQL数据库的Order表的接口，提供增删改查服务|


#### 信息视角

- 数据持久化对象（PO）

User类包含用户的编号（Integer，主键）、密码（String）、用户名（String）、电话号码（String）、信用分（double）、用户类型（枚举类型UserType）
Route类包含路线的编号（Integer，主键）、路线的名称（String）、所有车站的编号（List（Station））
Train类包含列车的编号（Integer，主键）、列车的名称（String）、列车起始站（Station）、列车终点站（Station）、日期（date）、所有出发时间（List（Time））、所有离开时间（List（Time））
Station类包含车站的编号（Integer、主键）、车站的名称（String）

- PostgreSQL数据库表
数据库中包括User表，Train表，Station表，Route表表中字段与PO类中属性相同，主键已在PO中说明，PO中的String在数据库中统一为varchar(255)，枚举类型统一为varchar(255)